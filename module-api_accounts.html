<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>api/accounts - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-api_accounts.html">api/accounts</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_accounts.html#createLocal">createLocal</a></li><li data-type='method' style='display: none;'><a href="module-api_accounts.html#authenticateLocal">authenticateLocal</a></li><li data-type='method' style='display: none;'><a href="module-api_accounts.html#initEmailConfirmation">initEmailConfirmation</a></li><li data-type='method' style='display: none;'><a href="module-api_accounts.html#confirmEmailWithCode">confirmEmailWithCode</a></li><li data-type='method' style='display: none;'><a href="module-api_accounts.html#sendPasswordRecoveryCode">sendPasswordRecoveryCode</a></li><li data-type='method' style='display: none;'><a href="module-api_accounts.html#checkPasswordRecoveryCode">checkPasswordRecoveryCode</a></li><li data-type='method' style='display: none;'><a href="module-api_accounts.html#issueNewPassword">issueNewPassword</a></li><li data-type='method' style='display: none;'><a href="module-api_accounts.html#logout">logout</a></li><li data-type='method' style='display: none;'><a href="module-api_accounts.html#getAccountData">getAccountData</a></li><li data-type='method' style='display: none;'><a href="module-api_accounts.html#list">list</a></li></ul></li><li><a href="module-api_accounts_social-network-integrations_telegram.html">api/accounts/social-network-integrations/telegram</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_accounts_social-network-integrations_telegram.html#initTelegramAccountIntegration">initTelegramAccountIntegration</a></li><li data-type='method' style='display: none;'><a href="module-api_accounts_social-network-integrations_telegram.html#getCommunity">getCommunity</a></li><li data-type='method' style='display: none;'><a href="module-api_accounts_social-network-integrations_telegram.html#checkCommunityMembership">checkCommunityMembership</a></li></ul></li><li><a href="module-api_accounts_social-network-integrations_vk.html">api/accounts/social-network-integrations/vk</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_accounts_social-network-integrations_vk.html#getCommunity">getCommunity</a></li><li data-type='method' style='display: none;'><a href="module-api_accounts_social-network-integrations_vk.html#checkCommunityMembership">checkCommunityMembership</a></li></ul></li><li><a href="module-api_games_crash.html">api/games/crash</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_games_crash.html#current">current</a></li><li data-type='method' style='display: none;'><a href="module-api_games_crash.html#join">join</a></li></ul></li><li><a href="module-api_games.html">api/games</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_games.html#playingHistory">playingHistory</a></li><li data-type='method' style='display: none;'><a href="module-api_games.html#playingStats">playingStats</a></li></ul></li><li><a href="module-api_inventory.html">api/inventory</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_inventory.html#itemsList">itemsList</a></li></ul></li><li><a href="module-api_oAuth.html">api/oAuth</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_oAuth.html#generateVKRedirect">generateVKRedirect</a></li><li data-type='method' style='display: none;'><a href="module-api_oAuth.html#handleVKRedirect">handleVKRedirect</a></li><li data-type='method' style='display: none;'><a href="module-api_oAuth.html#generateGoogleRedirect">generateGoogleRedirect</a></li><li data-type='method' style='display: none;'><a href="module-api_oAuth.html#handleGoogleRedirect">handleGoogleRedirect</a></li><li data-type='method' style='display: none;'><a href="module-api_oAuth.html#generateYandexRedirect">generateYandexRedirect</a></li><li data-type='method' style='display: none;'><a href="module-api_oAuth.html#handleYandexRedirect">handleYandexRedirect</a></li><li data-type='method' style='display: none;'><a href="module-api_oAuth.html#generateSteamRedirect">generateSteamRedirect</a></li><li data-type='method' style='display: none;'><a href="module-api_oAuth.html#~handleSteamRedirect">handleSteamRedirect</a></li></ul></li><li><a href="module-api_payments.html">api/payments</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_payments.html#depositRules">depositRules</a></li><li data-type='method' style='display: none;'><a href="module-api_payments.html#generateDepositRedirect">generateDepositRedirect</a></li></ul></li><li><a href="module-middleware_access.html">middleware/access</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-middleware_access.html#~setAuthCookie">setAuthCookie</a></li><li data-type='method' style='display: none;'><a href="module-middleware_access.html#~removeAuthCookie">removeAuthCookie</a></li><li data-type='method' style='display: none;'><a href="module-middleware_access.html#addAuthorizationDataToRequest">addAuthorizationDataToRequest</a></li><li data-type='method' style='display: none;'><a href="module-middleware_access.html#accessUser">accessUser</a></li><li data-type='method' style='display: none;'><a href="module-middleware_access.html#accessAdmin">accessAdmin</a></li></ul></li></ul><h3>Events</h3><ul><li><a href="module-api_accounts.html#.event:personal:account/balanceUpdate">personal:account/balanceUpdate</a></li><li><a href="module-api_accounts.html#.event:personal:account/accountDataUpdate">personal:account/accountDataUpdate</a></li><li><a href="module-api_games_crash.html#.event:public:crash-game/statusUpdate">public:crash-game/statusUpdate</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AccountPermissions">AccountPermissions</a></li><li><a href="global.html#AdminPermissionsScope">AdminPermissionsScope</a></li><li><a href="global.html#AccountData">AccountData</a></li><li><a href="global.html#CrashGamePublicState">CrashGamePublicState</a></li><li><a href="global.html#AccountStateRequirements">AccountStateRequirements</a></li><li><a href="global.html#GameType">GameType</a></li><li><a href="global.html#GameStatus">GameStatus</a></li><li><a href="global.html#Game">Game</a></li><li><a href="global.html#GameWin">GameWin</a></li><li><a href="global.html#GameBet">GameBet</a></li><li><a href="global.html#Player">Player</a></li><li><a href="global.html#PlayingStats">PlayingStats</a></li><li><a href="global.html#PlayingHistoryEntry">PlayingHistoryEntry</a></li><li><a href="global.html#SteamAppName">SteamAppName</a></li><li><a href="global.html#InventoryItemStatus">InventoryItemStatus</a></li><li><a href="global.html#InventoryItem">InventoryItem</a></li><li><a href="global.html#KNOWN_ACQUIRING_SYSTEMS">KNOWN_ACQUIRING_SYSTEMS</a></li><li><a href="global.html#PAYMENT_METHOD_KINDS">PAYMENT_METHOD_KINDS</a></li><li><a href="global.html#PAYMENT_METHOD_ICON_NAMES">PAYMENT_METHOD_ICON_NAMES</a></li><li><a href="global.html#PaymentMethod">PaymentMethod</a></li><li><a href="global.html#Status">Status</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">api/accounts</h1>
    

    




<section>

<header>
    
        
            
        
    
</header>

<article>
    
        <div class="container-overview">
        
            
                <div class="description usertext"><p>this endpoints represents the CRUD actions
with user accounts and login+password-based auth / logging out</p></div>
            

            
                




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































            
        
        </div>
    

    

    

    
    
    

     

    

    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    <h4 class="name" id="createLocal"><span class="type-signature">(route) </span>createLocal<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <h5>Handlers Chain:</h5>
                            <table class="params">
                            <thead><tr class="last"><th>Order</th></tr></thead>
                            <tr><td class="type">this handler</td></tr><tr><td class="type"><a href="module-api_accounts.html#authenticateLocal">module:api/accounts~authenticateLocal</a></td></tr>
                            </table>
                            <h5>Route:</h5>
                            <table class="params">
                            <thead><tr><th>Method</th><th class="last">Path</th></tr></thead>
                            <tr>
                            <td class="type">POST</td>
                            <td class="name last">/api/accounts/create-local</td>
                            </tr>
                            </table>
                            <p>It creates the local (username, email, password) account.
Email and username should be unique</p>
                            <h5>Body Parameters:</h5>
          <table class="params">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            <td class="name">email</td>
            <td class="type">String</td>
            
            
            <td class="description last">unique, from 5 to 40 chars</td>
          </tr><tr>
            <td class="name">username</td>
            <td class="type">String</td>
            
            
            <td class="description last">unique, from 4 to 40 chars</td>
          </tr><tr>
            <td class="name">password</td>
            <td class="type">String</td>
            
            
            <td class="description last">from 8 to 100 chars</td>
          </tr>
          </table>
                            <h5>Response:</h5>
          <table class="params">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            <td class="name">status</td>
            <td class="type">FAIL</td>
            
            
            <td class="description last">if internal error</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">WRONG_ARGS</td>
            
            
            <td class="description last">if some field isn't provided</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">accounts.INCORRECT_USERNAME_LENGTH</td>
            
            
            <td class="description last">if length of trimmed username isn't between 4 and 40</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">accounts.PASSWORD_INCORRECT</td>
            
            
            <td class="description last">if trimmed password length > 100 or comparison of generated password hash and provided password failed</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">accounts.PASSWORD_TOO_WEAK</td>
            
            
            <td class="description last">if password is shorter than 6 symbols</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">accounts.EMAIL_INCORRECT</td>
            
            
            <td class="description last">if trimmed email's length isn't between 5 and 40 chars or if email doesn't match
/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">accounts.USERNAME_EXISTS</td>
            
            
            <td class="description last">if username taken</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">accounts.EMAIL_EXISTS</td>
            
            
            <td class="description last">if email taken</td>
          </tr>
          </table>
                            <h5>Response Code:</h5>
          <table class="params">
            <thead>
              <tr>
                
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            
            <td class="type">200</td>
            
            
            <td class="description last">anyway</td>
          </tr>
          </table>
</div>




























        
            

    

    <h4 class="name" id="authenticateLocal"><span class="type-signature">(route) </span>authenticateLocal<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <h5>Handlers Chain:</h5>
                            <table class="params">
                            <thead><tr class="last"><th>Order</th></tr></thead>
                            <tr><td class="type">this endpoint</td></tr><tr><td class="type">OR</td></tr><tr><td class="type"><a href="module-api_accounts.html#createLocal">module:api/accounts~createLocal</a></td></tr><tr><td class="type">this endpoint</td></tr>
                            </table>
                            <h5>Route:</h5>
                            <table class="params">
                            <thead><tr><th>Method</th><th class="last">Path</th></tr></thead>
                            <tr>
                            <td class="type">POST</td>
                            <td class="name last">/api/accounts/authenticate-local</td>
                            </tr>
                            </table>
                            <p>Endpoint to authenticate user if he has the password (account was created as local or email was provided and confirmed)
You can provide credentials using &quot;username&quot;, &quot;email&quot; or the universal &quot;login&quot; field instead</p>
                            <h5>Body Parameters:</h5>
          <table class="params">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Attributes</th>
                <th>Default</th>
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            <td class="name">email</td>
            <td class="type">String</td>
            <td class="attributes">optional</td>
            <td class="default"></td>
            <td class="description last"></td>
          </tr><tr>
            <td class="name">username</td>
            <td class="type">String</td>
            <td class="attributes">optional</td>
            <td class="default"></td>
            <td class="description last"></td>
          </tr><tr>
            <td class="name">login</td>
            <td class="type">String</td>
            <td class="attributes">optional</td>
            <td class="default">provided username or email</td>
            <td class="description last"></td>
          </tr><tr>
            <td class="name">password</td>
            <td class="type">String</td>
            <td class="attributes"></td>
            <td class="default"></td>
            <td class="description last"></td>
          </tr>
          </table>
                            <h5>Header Parameters:</h5>
          <table class="params">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            <td class="name">host</td>
            <td class="type">String</td>
            
            
            <td class="description last">a domain to bind the auth cookie, for e.x. domain.com</td>
          </tr>
          </table>
                            <h5>Response:</h5>
          <table class="params">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            <td class="name">status</td>
            <td class="type">OK</td>
            
            
            <td class="description last">if success (responds with Set-Cookie header)</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">FAIL</td>
            
            
            <td class="description last">if internal error</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">WRONG_ARGS</td>
            
            
            <td class="description last">if fields login, username and email are empty</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">WRONG_ARGS</td>
            
            
            <td class="description last">if password isn't provided</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">INCORRECT_CREDENTIALS</td>
            
            
            <td class="description last">if password wrong</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">INCORRECT_CREDENTIALS</td>
            
            
            <td class="description last">if user with provided login/email/username not found</td>
          </tr>
          </table>
                            <h5>Response Code:</h5>
          <table class="params">
            <thead>
              <tr>
                
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            
            <td class="type">200</td>
            
            
            <td class="description last">anyway</td>
          </tr>
          </table>
</div>




























        
            

    

    <h4 class="name" id="initEmailConfirmation"><span class="type-signature">(route) </span>initEmailConfirmation<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <h5>Handlers Chain:</h5>
                            <table class="params">
                            <thead><tr class="last"><th>Order</th></tr></thead>
                            <tr><td class="type"><a href="module-middleware_access.html#addAuthorizationDataToRequest">module:middleware/access~addAuthorizationDataToRequest</a></td></tr><tr><td class="type"><a href="module-middleware_access.html#accessUser">module:middleware/access~accessUser</a></td></tr><tr><td class="type">this endpoint</td></tr>
                            </table>
                            <h5>Route:</h5>
                            <table class="params">
                            <thead><tr><th>Method</th><th class="last">Path</th></tr></thead>
                            <tr>
                            <td class="type">POST</td>
                            <td class="name last">/api/accounts/init-email-confirmation</td>
                            </tr>
                            </table>
                            <p>If user's email exists and still not confirmed, it mails the confirmation code
and saves it to the DB. The code will be resent and replaced on next request
by same user</p>
                            <h5>Response:</h5>
          <table class="params">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            <td class="name">status</td>
            <td class="type">OK</td>
            
            
            <td class="description last">if success and code sent</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">FAIL</td>
            
            
            <td class="description last">if internal error</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">WRONG_ARGS</td>
            
            
            <td class="description last">if account has no email or re-issuing the auth token needed</td>
          </tr>
          </table>
                            <h5>Response Code:</h5>
          <table class="params">
            <thead>
              <tr>
                
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            
            <td class="type">200</td>
            
            
            <td class="description last">on success result /request error / internal error</td>
          </tr>
          </table>
</div>




























        
            

    

    <h4 class="name" id="confirmEmailWithCode"><span class="type-signature">(route) </span>confirmEmailWithCode<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li>module:middleware/access.accessUser</li>
        </ul>
    </dd>
    

    
</dl>





<div class="description usertext">
    <h5>Handlers Chain:</h5>
                            <table class="params">
                            <thead><tr class="last"><th>Order</th></tr></thead>
                            <tr><td class="type"><a href="module-middleware_access.html#addAuthorizationDataToRequest">module:middleware/access~addAuthorizationDataToRequest</a></td></tr><tr><td class="type"><a href="module-middleware_access.html#accessUser">module:middleware/access~accessUser</a></td></tr><tr><td class="type">this endpoint</td></tr>
                            </table>
                            <h5>Route:</h5>
                            <table class="params">
                            <thead><tr><th>Method</th><th class="last">Path</th></tr></thead>
                            <tr>
                            <td class="type">POST</td>
                            <td class="name last">/api/accounts/confirm-email-with-code</td>
                            </tr>
                            </table>
                            <p>It compares the provided code with the sent one
(stored in DB). If they are same, user.email_confirmed
bool field becomes true.
<h5>Authentication</h5>
<p><a href="module-middleware_access.html#accessUser">module:middleware/access~accessUser</a></p></p>
                            <h5>Body Parameters:</h5>
          <table class="params">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            <td class="name">code</td>
            <td class="type">Number,String</td>
            
            
            <td class="description last"></td>
          </tr>
          </table>
                            <h5>Response:</h5>
          <table class="params">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            <td class="name">status</td>
            <td class="type">OK</td>
            
            
            <td class="description last">if code is correct and email confirmed</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">NOT_FOUND</td>
            
            
            <td class="description last">if email already confirmed / re-issuing auth token needed / email not exists</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">FAIL</td>
            
            
            <td class="description last">if internal error</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">WRONG_ARGS</td>
            
            
            <td class="description last">if no code provided</td>
          </tr>
          </table>
                            <h5>Response Code:</h5>
          <table class="params">
            <thead>
              <tr>
                
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            
            <td class="type">200</td>
            
            
            <td class="description last">on success result /request error / internal error</td>
          </tr>
          </table>
</div>




























        
            

    

    <h4 class="name" id="sendPasswordRecoveryCode"><span class="type-signature">(route) </span>sendPasswordRecoveryCode<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-todo">To Do:</dt>
    <dd class="tag-todo">
        <ul>
            <li>bcrypt is needed to store the hash of code instead of the plain numeric code</li>
        </ul>
    </dd>
    
</dl>





<div class="description usertext">
    <h5>Handlers Chain:</h5>
                            <table class="params">
                            <thead><tr class="last"><th>Order</th></tr></thead>
                            <tr><td class="type">this endpoint</td></tr>
                            </table>
                            <h5>Route:</h5>
                            <table class="params">
                            <thead><tr><th>Method</th><th class="last">Path</th></tr></thead>
                            <tr>
                            <td class="type">POST</td>
                            <td class="name last">/api/accounts/send-password-recovery-code</td>
                            </tr>
                            </table>
                            <p>It sends the code to provided email,
if with this email exists
To prevent registered-emails scanning we should ever response
by this route with the same time (for e.x. 2000ms)
This is 1 of 3 steps of password recovery</p>
                            <h5>Body Parameters:</h5>
          <table class="params">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            <td class="name">email</td>
            <td class="type">String</td>
            
            
            <td class="description last">the account's email</td>
          </tr>
          </table>
                            <h5>Response:</h5>
          <table class="params">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            <td class="name">status</td>
            <td class="type">FAIL</td>
            
            
            <td class="description last">if internal error</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">OK</td>
            
            
            <td class="description last">after constantly 2000ms if code sent or account with provided email not found</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">accounts.EMAIL_INCORRECT</td>
            
            
            <td class="description last">if trimmed email's length isn't between 5 and 40 chars or if email doesn't match</td>
          </tr><tr>
            <td class="name">if</td>
            <td class="type">WRONG_ARGS</td>
            
            
            <td class="description last">some data not passed
/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/</td>
          </tr>
          </table>
                            <h5>Response Code:</h5>
          <table class="params">
            <thead>
              <tr>
                
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            
            <td class="type">200</td>
            
            
            <td class="description last">anyway</td>
          </tr>
          </table>
</div>




























        
            

    

    <h4 class="name" id="checkPasswordRecoveryCode"><span class="type-signature">(route) </span>checkPasswordRecoveryCode<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <h5>Handlers Chain:</h5>
                            <table class="params">
                            <thead><tr class="last"><th>Order</th></tr></thead>
                            <tr><td class="type">this endpoint</td></tr>
                            </table>
                            <h5>Route:</h5>
                            <table class="params">
                            <thead><tr><th>Method</th><th class="last">Path</th></tr></thead>
                            <tr>
                            <td class="type">POST</td>
                            <td class="name last">/api/accounts/check-password-recovery-code</td>
                            </tr>
                            </table>
                            <p>This is 2 of 3 steps of password recovery</p>
<ol>
<li>User requests the code mailing</li>
<li>User types the code, we compares it and returns the bool val.
We still need the email field operating the code to prevent collisions.</li>
<li>If code is ok, we show to user the password and password confirmations
inputs.</li>
<li>User sends us the new password AND the code from prev step,
cause it is better than use temporary authorization methods.
Comparison of the code typed from user and the code stored in DB in .password_recovery_token field (by the provided .email)</li>
</ol>
                            <h5>Body Parameters:</h5>
          <table class="params">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            <td class="name">email</td>
            <td class="type">String</td>
            
            
            <td class="description last"></td>
          </tr><tr>
            <td class="name">code</td>
            <td class="type">String</td>
            
            
            <td class="description last"></td>
          </tr>
          </table>
                            <h5>Response:</h5>
          <table class="params">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            <td class="name">status,</td>
            <td class="type">WRONG_ARGS</td>
            
            
            <td class="description last">if code or email is not provided</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">accounts.EMAIL_INCORRECT</td>
            
            
            <td class="description last">if trimmed email's length isn't between 5 and 40 chars or if email doesn't match</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">OK</td>
            
            
            <td class="description last">if code comparison result is ok</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">FORBIDDEN</td>
            
            
            <td class="description last">if code is incorrect or user with this email not exists</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">FAIL</td>
            
            
            <td class="description last">if internal error</td>
          </tr>
          </table>
                            <h5>Response Code:</h5>
          <table class="params">
            <thead>
              <tr>
                
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            
            <td class="type">200</td>
            
            
            <td class="description last">anyway</td>
          </tr>
          </table>
</div>




























        
            

    

    <h4 class="name" id="issueNewPassword"><span class="type-signature">(route) </span>issueNewPassword<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <h5>Handlers Chain:</h5>
                            <table class="params">
                            <thead><tr class="last"><th>Order</th></tr></thead>
                            <tr><td class="type">this endpoint</td></tr><tr><td class="type">api/accounts~authenticateLocal</td></tr>
                            </table>
                            <h5>Route:</h5>
                            <table class="params">
                            <thead><tr><th>Method</th><th class="last">Path</th></tr></thead>
                            <tr>
                            <td class="type">POST</td>
                            <td class="name last">/api/accounts/issue-new-token</td>
                            </tr>
                            </table>
                            <p>This is the last, 3 of 3 steps of password recovery
User sends us his email, the new password AND the code from prev step.</p>
                            <h5>Body Parameters:</h5>
          <table class="params">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            <td class="name">email</td>
            <td class="type">String</td>
            
            
            <td class="description last"></td>
          </tr><tr>
            <td class="name">code</td>
            <td class="type">String</td>
            
            
            <td class="description last"></td>
          </tr><tr>
            <td class="name">new_password</td>
            <td class="type">String</td>
            
            
            <td class="description last"></td>
          </tr>
          </table>
                            <h5>Response:</h5>
          <table class="params">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            <td class="name">status</td>
            <td class="type">accounts.PASSWORD_INCORRECT</td>
            
            
            <td class="description last">if trimmed password length > 100 or comparison of generated password hash and provided password failed</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">accounts.PASSWORD_TOO_WEAK</td>
            
            
            <td class="description last">if password is shorter than 6 symbols</td>
          </tr><tr>
            <td class="name">status,</td>
            <td class="type">WRONG_ARGS</td>
            
            
            <td class="description last">if code or email is not provided</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">accounts.EMAIL_INCORRECT</td>
            
            
            <td class="description last">if trimmed email's length isn't between 5 and 40 chars or if email doesn't match</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">OK</td>
            
            
            <td class="description last">if code comparison result is ok</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">FORBIDDEN</td>
            
            
            <td class="description last">if code is incorrect or user with this email not exists</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">FAIL</td>
            
            
            <td class="description last">if internal error</td>
          </tr>
          </table>
</div>




























        
            

    

    <h4 class="name" id="logout"><span class="type-signature">(route) </span>logout<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <h5>Handlers Chain:</h5>
                            <table class="params">
                            <thead><tr class="last"><th>Order</th></tr></thead>
                            <tr><td class="type"><a href="module-middleware_access.html#addAuthorizationDataToRequest">module:middleware/access~addAuthorizationDataToRequest</a></td></tr><tr><td class="type"><a href="module-middleware_access.html#accessUser">module:middleware/access~accessUser</a></td></tr><tr><td class="type">this endpoint</td></tr>
                            </table>
                            <h5>Route:</h5>
                            <table class="params">
                            <thead><tr><th>Method</th><th class="last">Path</th></tr></thead>
                            <tr>
                            <td class="type">POST</td>
                            <td class="name last">/api/accounts/logout</td>
                            </tr>
                            </table>
                            <p>It adds the set-cookie header with empty content of auth cookie
<h5>Authentication</h5>
<p><a href="module-middleware_access.html#accessUser">module:middleware/access~accessUser</a></p></p>
                            <h5>Response:</h5>
          <table class="params">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            <td class="name">status</td>
            <td class="type">FAIL</td>
            
            
            <td class="description last">if internal error</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">OK</td>
            
            
            <td class="description last">if auth cookie is removed</td>
          </tr>
          </table>
                            <h5>Response Code:</h5>
          <table class="params">
            <thead>
              <tr>
                
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            
            <td class="type">200</td>
            
            
            <td class="description last">anyway</td>
          </tr>
          </table>
</div>




























        
            

    

    <h4 class="name" id="getAccountData"><span class="type-signature">(route) </span>getAccountData<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <h5>Handlers Chain:</h5>
                            <table class="params">
                            <thead><tr class="last"><th>Order</th></tr></thead>
                            <tr><td class="type"><a href="module-middleware_access.html#addAuthorizationDataToRequest">module:middleware/access~addAuthorizationDataToRequest</a></td></tr><tr><td class="type"><a href="module-middleware_access.html#accessUser">module:middleware/access~accessUser</a></td></tr><tr><td class="type">this endpoint</td></tr>
                            </table>
                            <h5>Route:</h5>
                            <table class="params">
                            <thead><tr><th>Method</th><th class="last">Path</th></tr></thead>
                            <tr>
                            <td class="type">GET</td>
                            <td class="name last">/api/accounts/get-account-data</td>
                            </tr>
                            </table>
                            <p>It returns the account data in JSON format
The account's balance calculation uses a SQL template module:database/balance~insertBalanceCalculationTemplate
<h5>Authentication</h5>
<p><a href="module-middleware_access.html#accessUser">module:middleware/access~accessUser</a></p></p>
                            <h5>Response:</h5>
          <table class="params">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            <td class="name">status</td>
            <td class="type">FAIL</td>
            
            
            <td class="description last">if internal error</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">NOT_FOUND</td>
            
            
            <td class="description last">if user not found using credentials from auth token</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">OK</td>
            
            
            <td class="description last">if user found</td>
          </tr><tr>
            <td class="name">account_data</td>
            <td class="type">AccountData</td>
            
            
            <td class="description last">if status is OK</td>
          </tr>
          </table>
</div>




























        
            

    

    <h4 class="name" id="list"><span class="type-signature">(route) </span>list<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <h5>Handlers Chain:</h5>
                            <table class="params">
                            <thead><tr class="last"><th>Order</th></tr></thead>
                            <tr><td class="type"><a href="module-middleware_access.html#addAuthorizationDataToRequest">module:middleware/access~addAuthorizationDataToRequest</a></td></tr><tr><td class="type"><a href="module-middleware_access.html#accessAdmin">module:middleware/access~accessAdmin</a></td></tr><tr><td class="type">this endpoint</td></tr>
                            </table>
                            <h5>Route:</h5>
                            <table class="params">
                            <thead><tr><th>Method</th><th class="last">Path</th></tr></thead>
                            <tr>
                            <td class="type">GET</td>
                            <td class="name last">/api/accounts/list</td>
                            </tr>
                            </table>
                            <p>It returns sorted &amp; filtered &amp; paginated list of user accounts</p>
                            <h5>Response:</h5>
          <table class="params">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Attributes</th>
                
                <th class="last">Description</th>
              </tr>
            </thead>
            <tr>
            <td class="name">status</td>
            <td class="type">OK</td>
            <td class="attributes"></td>
            
            <td class="description last">if success</td>
          </tr><tr>
            <td class="name">accounts</td>
            <td class="type">Array.&lt;User&gt;</td>
            <td class="attributes">optional</td>
            
            <td class="description last">if success</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">FORBIDDEN</td>
            <td class="attributes"></td>
            
            <td class="description last">if auth cookie doesnt contain the .ACCOUNTS permissions scope</td>
          </tr><tr>
            <td class="name">status</td>
            <td class="type">FAIL</td>
            <td class="attributes"></td>
            
            <td class="description last">if internal error</td>
          </tr>
          </table>
</div>




























        
    

    

    
        <h3 class="subsection-title">Events</h3>

        
            

    

    <h4 class="name" id=".event:personal:account/balanceUpdate">personal:account/balanceUpdate</h4>

    




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>



    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>balance</code></td>
            

            <td class="type">
            
                
<span class="param-type">Number</span>


            
            </td>

            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>




















<h5>Fires:</h5>
<ul>
    <li>event:on balance update</li>
</ul>














        
            

    

    <h4 class="name" id=".event:personal:account/accountDataUpdate">personal:account/accountDataUpdate</h4>

    




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>



    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>account_data</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#AccountData">AccountData</a></span>


            
            </td>

            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>




















<h5>Fires:</h5>
<ul>
    <li>event:on some <a href="global.html#AccountData">AccountData</a> fields update</li>
</ul>














        
    
</article>

</section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> on Tue Feb 16 2021 03:15:50 GMT+0300 (Moscow Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>